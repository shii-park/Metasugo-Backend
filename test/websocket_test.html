<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¡ã‚¿ãƒãƒ¼ã™ã”ã‚ã WebSocket ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .panel-content {
            padding: 20px;
        }

        /* æ¥ç¶šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .connection-section {
            margin-bottom: 20px;
        }

        .connection-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .connection-section input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
            margin-bottom: 10px;
        }

        .connection-section input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .connection-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        .status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-connected {
            background: #4caf50;
            color: white;
        }

        .status-disconnected {
            background: #f44336;
            color: white;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .controls-grid {
            display: grid;
            gap: 15px;
        }

        .control-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }

        .control-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .control-card h3 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .control-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .control-card label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .control-card input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .control-card input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-option label {
            cursor: pointer;
            margin: 0;
        }

        .btn-action {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-action:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        #log {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 15px;
            height: calc(100vh - 200px);
            overflow-y: auto;
            border-radius: 5px;
        }

        .log-entry {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 3px solid #667eea;
            background: #252526;
            border-radius: 3px;
        }

        .log-entry.sent {
            border-left-color: #4caf50;
        }

        .log-entry.received {
            border-left-color: #2196f3;
        }

        .log-entry.error {
            border-left-color: #f44336;
        }

        .log-entry.system {
            border-left-color: #ff9800;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .log-type {
            font-weight: bold;
            text-transform: uppercase;
        }

        .log-type.sent { color: #4caf50; }
        .log-type.received { color: #2196f3; }
        .log-type.error { color: #f44336; }
        .log-type.system { color: #ff9800; }

        .log-time {
            color: #858585;
            font-size: 12px;
        }

        .log-content {
            white-space: pre-wrap;
            word-break: break-word;
        }

        .log-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #log::-webkit-scrollbar {
            width: 10px;
        }

        #log::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        #log::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 5px;
        }

        #log::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ãƒ‘ãƒãƒ«ï¼šæ¥ç¶šã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="panel">
            <div class="panel-header">
                ğŸ® ãƒ¡ã‚¿ãƒãƒ¼ã™ã”ã‚ã WebSocket ãƒ†ã‚¹ãƒˆ
            </div>
            <div class="panel-content">
                <!-- æ¥ç¶šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="connection-section">
                    <div id="connection-status">
                        <span class="status status-disconnected">æœªæ¥ç¶š</span>
                    </div>
                    
                    <label for="auth-token">ğŸ”‘ Firebase ID Token:</label>
                    <input type="text" id="auth-token" placeholder="Firebaseã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                    
                    <label for="ws-url">ğŸŒ WebSocket URL:</label>
                    <input type="text" id="ws-url" value="ws://localhost:8080/ws">
                    
                    <div class="connection-buttons">
                        <button class="btn btn-primary" id="connect-btn">æ¥ç¶š</button>
                        <button class="btn btn-danger" id="disconnect-btn" disabled>åˆ‡æ–­</button>
                    </div>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid #e0e0e0;">

                <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="controls-grid">
                    <!-- ROLL_DICE -->
                    <div class="control-card">
                        <h3>ğŸ² ROLL_DICE</h3>
                        <p>ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ã¦ã‚³ãƒã‚’é€²ã‚ã¾ã™ã€‚ã‚²ãƒ¼ãƒ ã®åŸºæœ¬ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚</p>
                        <button class="btn-action" id="roll-dice-btn" disabled>ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
                    </div>

                    <!-- SUBMIT_CHOICE -->
                    <div class="control-card">
                        <h3>ğŸ”€ SUBMIT_CHOICE</h3>
                        <p>åˆ†å²ãƒã‚¹ï¼ˆbranchï¼‰ã§ç§»å‹•å…ˆã‚’é¸æŠã—ã¾ã™ã€‚</p>
                        <label for="choice-selection">é¸æŠã™ã‚‹ã‚¿ã‚¤ãƒ«ID:</label>
                        <input type="number" id="choice-selection" placeholder="ä¾‹: 15">
                        <button class="btn-action" id="submit-choice-btn" disabled>é¸æŠã‚’é€ä¿¡</button>
                    </div>

                    <!-- SUBMIT_GAMBLE -->
                    <div class="control-card">
                        <h3>ğŸ° SUBMIT_GAMBLE</h3>
                        <p>ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ãƒã‚¹ï¼ˆgambleï¼‰ã§ãƒã‚¤ãƒ»ãƒ­ãƒ¼ã‚’äºˆæƒ³ã—ã¾ã™ã€‚</p>
                        <label for="gamble-bet">è³­ã‘é‡‘:</label>
                        <input type="number" id="gamble-bet" placeholder="ä¾‹: 100" value="100">
                        <label>äºˆæƒ³:</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="gamble-high" name="gamble-choice" value="High" checked>
                                <label for="gamble-high">High (7ä»¥ä¸Š)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="gamble-low" name="gamble-choice" value="Low">
                                <label for="gamble-low">Low (6ä»¥ä¸‹)</label>
                            </div>
                        </div>
                        <button class="btn-action" id="submit-gamble-btn" disabled>ã‚®ãƒ£ãƒ³ãƒ–ãƒ«å®Ÿè¡Œ</button>
                    </div>

                    <!-- SUBMIT_QUIZ -->
                    <div class="control-card">
                        <h3>ğŸ“ SUBMIT_QUIZ</h3>
                        <p>ã‚¯ã‚¤ã‚ºãƒã‚¹ï¼ˆquizï¼‰ã§å›ç­”ã‚’é¸æŠã—ã¾ã™ã€‚å›ç­”ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯0ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚</p>
                        <label for="quiz-selection">å›ç­”ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:</label>
                        <input type="number" id="quiz-selection" placeholder="ä¾‹: 0 (æœ€åˆã®é¸æŠè‚¢)">
                        <button class="btn-action" id="submit-quiz-btn" disabled>å›ç­”ã‚’é€ä¿¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ãƒ‘ãƒãƒ«ï¼šãƒ­ã‚° -->
        <div class="panel">
            <div class="panel-header">
                ğŸ“‹ é€šä¿¡ãƒ­ã‚°
            </div>
            <div class="panel-content">
                <div class="log-controls">
                    <button class="btn btn-primary btn-small" id="clear-log-btn">ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
                    <button class="btn btn-primary btn-small" id="export-log-btn">ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                </div>
                <div id="log"></div>
            </div>
        </div>
    </div>

    <script>
        const wsUrlInput = document.getElementById('ws-url');
        const authTokenInput = document.getElementById('auth-token');
        const connectBtn = document.getElementById('connect-btn');
        const disconnectBtn = document.getElementById('disconnect-btn');
        const logDiv = document.getElementById('log');
        const connectionStatus = document.getElementById('connection-status');
        const clearLogBtn = document.getElementById('clear-log-btn');
        const exportLogBtn = document.getElementById('export-log-btn');

        const allButtons = [
            'roll-dice-btn', 'submit-choice-btn', 'submit-gamble-btn', 'submit-quiz-btn'
        ];

        let socket;
        let logEntries = [];

        function updateConnectionStatus(connected) {
            if (connected) {
                connectionStatus.innerHTML = '<span class="status status-connected">æ¥ç¶šä¸­</span>';
            } else {
                connectionStatus.innerHTML = '<span class="status status-disconnected">æœªæ¥ç¶š</span>';
            }
        }

        function log(type, message) {
            const entry = {
                type: type.toLowerCase(),
                time: new Date().toLocaleTimeString('ja-JP'),
                message: message
            };
            logEntries.push(entry);

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${entry.type}`;
            
            const logHeader = document.createElement('div');
            logHeader.className = 'log-header';
            
            const logType = document.createElement('span');
            logType.className = `log-type ${entry.type}`;
            logType.textContent = entry.type;
            
            const logTime = document.createElement('span');
            logTime.className = 'log-time';
            logTime.textContent = entry.time;
            
            logHeader.appendChild(logType);
            logHeader.appendChild(logTime);
            
            const logContent = document.createElement('div');
            logContent.className = 'log-content';
            
            if (typeof message === 'object') {
                logContent.textContent = JSON.stringify(message, null, 2);
            } else {
                logContent.textContent = message;
            }
            
            logEntry.appendChild(logHeader);
            logEntry.appendChild(logContent);
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function setControlsDisabled(disabled) {
            connectBtn.disabled = !disabled;
            disconnectBtn.disabled = disabled;
            allButtons.forEach(id => {
                document.getElementById(id).disabled = disabled;
            });
        }

        clearLogBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';
            logEntries = [];
            log('SYSTEM', 'ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        });

        exportLogBtn.addEventListener('click', () => {
            const logText = logEntries.map(entry => 
                `[${entry.type.toUpperCase()}] ${entry.time}\n${typeof entry.message === 'object' ? JSON.stringify(entry.message, null, 2) : entry.message}\n`
            ).join('\n---\n\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `websocket-log-${new Date().toISOString()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('SYSTEM', 'ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        });

        connectBtn.addEventListener('click', () => {
            const url = wsUrlInput.value;
            const token = authTokenInput.value;

            if (!token) {
                alert('Firebase ID Tokenã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const fullUrl = `${url}?token=${encodeURIComponent(token)}`;
            log('SYSTEM', `æ¥ç¶šä¸­: ${fullUrl}`);
            socket = new WebSocket(fullUrl);

            socket.onopen = () => {
                log('SYSTEM', 'WebSocketæ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã¾ã—ãŸ');
                updateConnectionStatus(true);
                setControlsDisabled(false);
            };

            socket.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    log('RECEIVED', data);
                } catch (e) {
                    log('RECEIVED', event.data);
                }
            };

            socket.onclose = (event) => {
                log('SYSTEM', `WebSocketæ¥ç¶šãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ (ã‚³ãƒ¼ãƒ‰: ${event.code}, ç†ç”±: ${event.reason || 'ãªã—'})`);
                updateConnectionStatus(false);
                setControlsDisabled(true);
            };

            socket.onerror = (error) => {
                log('ERROR', `WebSocketã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}`);
            };
        });

        disconnectBtn.addEventListener('click', () => {
            if (socket) {
                socket.close();
                log('SYSTEM', 'åˆ‡æ–­ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ');
            }
        });

        function sendMessage(type, payload) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const message = { type, payload };
                socket.send(JSON.stringify(message));
                log('SENT', message);
            } else {
                log('ERROR', 'WebSocketãŒæ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                alert('WebSocketãŒæ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ˆã«æ¥ç¶šã—ã¦ãã ã•ã„ã€‚');
            }
        }

        document.getElementById('roll-dice-btn').addEventListener('click', () => {
            sendMessage('ROLL_DICE', {});
        });

        document.getElementById('submit-choice-btn').addEventListener('click', () => {
            const value = document.getElementById('choice-selection').value;
            if (value === '') {
                alert('ã‚¿ã‚¤ãƒ«IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            const selection = parseInt(value, 10);
            if (isNaN(selection)) {
                alert('æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            sendMessage('SUBMIT_CHOICE', { selection: selection });
        });
        
        document.getElementById('submit-gamble-btn').addEventListener('click', () => {
            const bet = parseInt(document.getElementById('gamble-bet').value, 10);
            const choice = document.querySelector('input[name="gamble-choice"]:checked').value;
            if (isNaN(bet) || bet <= 0) {
                alert('æœ‰åŠ¹ãªè³­ã‘é‡‘ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            sendMessage('SUBMIT_GAMBLE', { bet, choice });
        });

        document.getElementById('submit-quiz-btn').addEventListener('click', () => {
            const value = document.getElementById('quiz-selection').value;
            if (value === '') {
                alert('å›ç­”ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            const selection = parseInt(value, 10);
            if (isNaN(selection)) {
                alert('æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            sendMessage('SUBMIT_QUIZ', { selection: selection });
        });

        // åˆæœŸçŠ¶æ…‹ã®è¨­å®š
        updateConnectionStatus(false);
        log('SYSTEM', 'ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‚’èµ·å‹•ã—ã¾ã—ãŸ');
    </script>
</body>
</html>
